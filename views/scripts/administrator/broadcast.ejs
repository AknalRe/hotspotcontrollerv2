<script src="/socket.io/socket.io.js"></script>
<script>
    const mikrotikstatus = '<%= mikrotik %>';
    // console.log("Mikrotik :",mikrotikstatus);
    function bytesToMegabytes(bytes) {
        const megabytes = bytes / (1024 * 1024);
        return megabytes;
    }

    const socket = io();
    if (mikrotikstatus) {
        toastToast(true, "", "Memproses mengambil info router")
        socket.on('resource', function(data) {
            // console.log(data.data[0]);
            const resource = data.data[0];
            document.getElementById("info-mikrotik-cpu").innerHTML = resource["cpu-load"] + "%";
            document.getElementById("info-mikrotik-memory").innerHTML = bytesToMegabytes(resource["free-memory"]).toFixed(0) + "MB";
        })

        socket.on('userhotspot', function(data) {
            const hotspot = data.data;
            // console.log(hotspot);
            document.getElementById("info-mikrotik-user-hotspot-aktif").innerHTML = hotspot.length;
        })
    }

</script>
<script>
    updatelistklien();

    function updatelistklien() {
        toastToast(true, "", "Memproses ambil data jenis akun");
        fetch('/listklienbroadcast', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                // Hapus semua opsi saat ini
                console.log(data)
                toastToast(data.success, "", data.message);
                if (data.success) {
                    const selectElement = document.getElementById('tujuan');
                    selectElement.innerHTML = "";

                    const semuaOption = document.createElement('option');
                    semuaOption.textContent = "Semua";
                    semuaOption.value = "semua";
                    selectElement.appendChild(semuaOption);

                    data.data.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.textContent = option.name;
                        optionElement.value = option.name;
                        selectElement.appendChild(optionElement);
                    });
                }
            })
            .catch(error => {
                toastToast(true, "", `Gagal Mendapatkan data jenis akun, Error: ${error}`);
                console.log('Error:', error);
            });
    }
</script>